# Простой Telegram-бот для поиска ресторанов

## Содержание

1. [Бот для поиска ближайших ресторанов быстрого питания](#Бот_для_поиска_ближайших_ресторанов_быстрого_питания)
2. [Основные моменты при реализации](#Основные_моменты_при_реализации)
3. [Реализация поиска заведений и геокодера](#Реализация_поиска_заведений_и_геокодера)  
    3.1 [Geocoder API](#Geocoder_API)  
    3.2 [Places API](#Places_API)  
    3.3 [Альтернатива с использованием Яндекс-сервисов](#Альтернатива_с_использованием_Яндекс-сервисов)  

<a name="Бот_для_поиска_ближайших_ресторанов_быстрого_питания"></a>
## Бот для поиска ближайших ресторанов быстрого питания

_**Программа создана для изучения основ при работе с картами с помощью Telegram-бота.**_

Программа выполняет поиск ближайших ресторанов по местоположению пользователя или названию станции метро в Санкт-Петербурге. Пользователю предоставляется выбор из четырех ресторанов:
 + McDonald’s
 + KFC
 + Subway
 + Burger King
 
Бот отправляет местоположение ближайших ресторанов через точки на картах. Пользователь может выбрать ресторан, который лучше всего соответствует его предпочтениям.  

Отправка локаций пользователю оптимизирована: бот отправляет одну локацию и предоставляет вариант выбора другой или изменения ресторана. 

[Видео](https://drive.google.com/file/d/1--etGkIuulyfVxT6oECJTEflRvLrKDIb/view?usp=sharing), демонстрирующее работу программы.

<a name="Основные_моменты_при_реализации"></a>
## Основные моменты при реализации

Бот написан на языке Python 3 с использованием библиотеки pyTelegramBotAPI (документация [Telegram Bot API](https://core.telegram.org/bots/api)). Для реализации бота создано три файла.

Основные функции бота, реагирующие на действия пользователя, находятся в файле _bot_eat.py_.

Файл _functions.py_ содержит реализацию функций, необходимых для корректной работы программы. Здесь находятся как функции для работы с картами, так и функции вывода текста и кнопок. 

API-ключи и токен бота помещены в файл _config.py_. Для запуска программы необходимо добавить свои данные в этот файл.

<a name="Реализация_поиска_заведений_и_геокодера"></a>
## Реализация поиска заведений и геокодера
 
Работа с картами выполнена с использованием сервиса _2gis_ и библиотек requests и json. Для этого не требуется несколько ключей для разных действий. В реализации использованы сервисы _Geocoder API_ и _Places API_.

<a name="Geocoder_API"></a>
### Geocoder API

- Используется для определения координат станций метро, введенных пользователем. 
- Пример использования в функции _func_geo_gis_.
- [Документация Geocoder API](https://docs.2gis.com/ru/api/search/geocoder/overview) для 2gis.
- Альтернатива при использовании сервисов Яндекс: API Геокодера.

Пример отправки запроса на сайт config.gis_geo для получения координат объекта query и преобразования полученного json в список:
```python
query = 'СПб метро ' + message.text 
r = requests.get(url=config.gis_geo, params={
    'q' : query,
    'key': config.API_key_gis,
    'fields' : 'items.point'
}) 
result = json.loads(r.text)
```

Обработка результатов выполняется согласно документации.
```python
point = str(result['result']['items'][0]['point']['lon']) + ',' + str(result['result']['items'][0]['point']['lat'])
```

<a name="Places_API"></a>
### Places API
- Используется для нахождения ближайших заведений на карте по координатам в определенном радиусе. 
- Пример использования в функции _func_search_gis_.
- [Документация Places API](https://docs.2gis.com/ru/api/search/places/overview) для 2gis.
- Альтернатива при использовании сервисов Яндекс: API поиска по организациям.

Пример отправки запроса на сайт config.gis_search для получения объекта call.data в радиусе 1000 метров от точки point и последующего преобразования в список:
```python
r = requests.get(url=config.gis_search, params={
    'q' : call.data,
    'key': config.API_key_gis,
    'point' : point,
    'type' : 'branch',
    'fields' :'items.point,items.schedule',
    'radius' : '1000'
}) 
result = json.loads(r.text)
```

Работа с результатами, представленными списками из нескольких элементов, может быть

 различной. Можно использовать цикл со счетчиком для перебора всех элементов списка.

Пример отправки ботом полученных результатов пользователю с использованием цикла for:
```python
for item in result['result']['items']:
    bot.send_venue(call.message.chat.id, item['point']['lat'], item['point']['lon'], item['name'], item['address_name'])
```

Также, зная количество элементов в списке, можно обрабатывать каждый элемент по отдельности.
```python
bot.send_venue(chat_id=call.message.chat.id, 
    latitude=result['result']['items'][cnt]['point']['lat'], 
    longitude=result['result']['items'][cnt]['point']['lon'], 
    title=result['result']['items'][cnt]['name'], 
    address=result['result']['items'][cnt]['address_name'])
```

<a name="Альтернатива_с_использованием_Яндекс-сервисов"></a>
### Альтернатива с использованием Яндекс-сервисов

При работе с картами через Яндекс-сервисы необходим индивидуальный ключ для каждого сервиса. В работе также используются библиотеки requests и json. 
Однако параметры запроса и работа с объектом json должны соответствовать документации. 

+ [Документация API Геокодера](https://yandex.ru/dev/maps/geocoder/doc/desc/concepts/about.html) для Яндекс-сервисов.
+ [Документация API поиска по организациям](https://yandex.ru/dev/maps/geosearch/doc/concepts/about.html) для Яндекс-сервисов.
